<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ค้นหาข้อมูล PEA</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <h1>ค้นหาข้อมูล PEA</h1>
    <input type="text" id="peaInput" placeholder="กรอกเลข PEA">
    <button onclick="searchData()">ค้นหา</button>
    <div id="result"></div>

    <button onclick="sendToChatbot()">ส่งไปยัง LINE</button>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycbxokwjWlcvAziZM0KOzMdb4DTBHUrKH3h-0g08-Oa3dtM_ZjNlbqgNxEcUhY-B_yAiJ/exec"; // ใส่ URL ของ Apps Script API

        function searchData() {
            let pea = document.getElementById("peaInput").value;
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    let result = data.find(item => item.pea == pea);
                    if (result) {
                        document.getElementById("result").innerHTML = `
                            <p>รายได้: ${result.income}</p>
                            <p>ต้นทุน: ${result.cost}</p>
                            <p>กำไร/ขาดทุน: ${result.profit}</p>
                            <p>อัตราส่วน: ${result.ratio}</p>
                        `;
                    } else {
                        document.getElementById("result").innerHTML = "<p>ไม่พบข้อมูล</p>";
                    }
                })
                .catch(error => console.error("Error:", error));
        }

        function sendToChatbot() {
            if (!liff.isInClient()) {
                alert("กรุณาเปิดใน LINE App");
                return;
            }
            let pea = document.getElementById("peaInput").value;
            let resultText = document.getElementById("result").innerText;

            liff.sendMessages([
                {
                    type: "text",
                    text: `ผลการค้นหา:\n${resultText}`
                }
            ])
            .then(() => {
                alert("ส่งไปยัง LINE Chatbot สำเร็จ!");
                liff.closeWindow();
            })
            .catch(err => alert("ส่งไม่สำเร็จ: " + err));
        }

        function initializeLiff() {
            liff.init({ liffId: "2006772952-pxMLlYMG" }) // ใส่ LIFF ID
                .then(() => console.log("LIFF Initialized"))
                .catch(err => console.error("LIFF Initialization failed", err));
        }

        initializeLiff();
    </script>
</body>
</html>
