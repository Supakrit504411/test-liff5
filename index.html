<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PEA</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <h1>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PEA</h1>
    <input type="text" id="peaInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç PEA">
    <button onclick="searchData()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    <div id="result"></div>

    <button onclick="sendToChatbot()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE</button>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycbwl_ssMxh5IUDbT_7MLXPXGLzeOgfgBtZgJ14vByLLdjPM1QTXd0NOfHPqE5BUQ3f4K/exec"; // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script API

        function searchData() {
            let pea = document.getElementById("peaInput").value;
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    let result = data.find(item => item.pea == pea);
                    if (result) {
                        document.getElementById("result").innerHTML = `
                            <p>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${result.income}</p>
                            <p>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${result.cost}</p>
                            <p>‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô: ${result.profit}</p>
                            <p>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô: ${result.ratio}</p>
                        `;
                    } else {
                        document.getElementById("result").innerHTML = "<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>";
                    }
                })
                .catch(error => console.error("Error:", error));
        }

        function sendToChatbot() {
    if (!liff.isInClient()) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App");
        return;
    }

    let pea = document.getElementById("peaInput").value;
    liff.getProfile()
        .then(profile => {
            let userId = profile.userId;
            fetch("https://script.google.com/macros/s/AKfycbwl_ssMxh5IUDbT_7MLXPXGLzeOgfgBtZgJ14vByLLdjPM1QTXd0NOfHPqE5BUQ3f4K/exec", { // üîπ ‡πÉ‡∏™‡πà URL Google Apps Script
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId: userId, pea: pea })
            })
            .then(response => response.json())
            .then(data => {
                alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE Chatbot ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                liff.closeWindow();
            })
            .catch(err => alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err));
        })
        .catch(err => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: " + err));
}


        function initializeLiff() {
            liff.init({ liffId: "2006772952-pxMLlYMG" }) // ‡πÉ‡∏™‡πà LIFF ID
                .then(() => console.log("LIFF Initialized"))
                .catch(err => console.error("LIFF Initialization failed", err));
        }

        initializeLiff();
    </script>
</body>
</html>
